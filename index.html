<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>For Riti üíï</title>
  <meta name="description" content="A special Valentine for someone extraordinary" />
  <style>
:root{
  --accent:#e71e63;
  --accent-light:#ff6b9d;
  --soft:#ffdee9;
  --muted:#666;
  --card:#fff;
  --glass: rgba(255,255,255,0.95);
  --shadow: 0 20px 60px rgba(231, 30, 99, 0.25);
  --ease-out: cubic-bezier(0.22, 1, 0.36, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;font-family:'Segoe UI',system-ui,-apple-system,Roboto,Helvetica,Arial,sans-serif;overflow-x:hidden}

body{
  background: linear-gradient(160deg,#ff9bb3 0%, #ffd7e0 55%, #fff7fb 100%);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  color:#222;
  position:relative;
  overflow:hidden;
  touch-action:pan-y;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  text-rendering:optimizeLegibility;
}

/* Enhanced background canvas with glow */
#bg{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;
  pointer-events:none;
}

/* Animated gradient overlay */
.gradient-overlay{
  position:fixed;
  inset:0;
  background: 
    radial-gradient(circle at calc(20% + var(--gox, 0px)) calc(50% + var(--goy, 0px)), rgba(255, 107, 157, 0.15) 0%, transparent 50%),
    radial-gradient(circle at calc(80% + var(--gox2, 0px)) calc(80% + var(--goy2, 0px)), rgba(231, 30, 99, 0.1) 0%, transparent 50%);
  z-index:1;
  pointer-events:none;
  animation:gradientShift 15s ease-in-out infinite;
  transform:translate3d(var(--px, 0px), var(--py, 0px), 0) scale(1.02);
  will-change:transform;
}

@keyframes gradientShift{
  0%, 100%{opacity:0.5}
  50%{opacity:0.8}
}

/* Page transitions */
.page{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  z-index:10;
  opacity:0;
  transform:translateY(16px) scale(0.985);
  pointer-events:none;
  transition:opacity 0.55s var(--ease-out), transform 0.55s var(--ease-out);
  will-change:opacity, transform;
}

.reveal{
  opacity:0;
  transform:translateY(18px) scale(0.99);
  transition:opacity 0.7s var(--ease-out), transform 0.7s var(--ease-out);
  transition-delay:var(--reveal-delay, 0ms);
  will-change:opacity, transform;
}

.reveal.is-revealed{
  opacity:1;
  transform:translateY(0) scale(1);
}

.ripple{
  position:absolute;
  border-radius:999px;
  transform:scale(0);
  opacity:0.55;
  pointer-events:none;
  background:radial-gradient(circle, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.55) 40%, rgba(255,255,255,0) 72%);
  animation:ripple 650ms var(--ease-out) forwards;
  mix-blend-mode:overlay;
}

@keyframes ripple{
  to{transform:scale(1);opacity:0}
}

.page.active{
  opacity:1;
  transform:translateY(0) scale(1);
  pointer-events:all;
}

/* LANDING PAGE - First Heart */
.landing-content{
  text-align:center;
}

@keyframes fadeInUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:translateY(0)}
}

.big-heart{
  font-size:180px;
  cursor:pointer;
  display:inline-block;
  animation:heartBeat 2s ease-in-out infinite;
  filter:drop-shadow(0 8px 24px rgba(231,30,99,0.4));
  transition:transform 0.35s var(--ease-out), filter 0.35s var(--ease-out);
  will-change:transform;
  user-select:none;
}

.big-heart:focus-visible{
  outline:3px solid rgba(231,30,99,0.28);
  outline-offset:10px;
  border-radius:18px;
}

.big-heart:hover{
  animation-play-state:paused;
  transform:scale(1.06);
  filter:drop-shadow(0 14px 34px rgba(231,30,99,0.45));
}

.big-heart:active{
  transform:scale(0.9);
}

@keyframes heartBeat{
  0%, 100%{transform:scale(1)}
  10%{transform:scale(1.1)}
  20%{transform:scale(1)}
  30%{transform:scale(1.15)}
  40%{transform:scale(1)}
}

.tap-hint{
  font-size:1.1rem;
  color:var(--muted);
  margin-top:20px;
  font-style:italic;
  opacity:0;
  animation:fadeIn 1s ease-out 1s both;
}

@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}

/* QUESTION PAGE */
.question-content{
  width:100%;
  max-width:420px;
  text-align:center;
}

@keyframes slideIn{
  from{opacity:0;transform:scale(0.8) translateY(50px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}

.question-card{
  background:linear-gradient(180deg,var(--glass),#fff);
  border-radius:24px;
  padding:40px 24px;
  box-shadow:var(--shadow);
  margin-bottom:20px;
  position:relative;
  overflow:hidden;
  border:1px solid rgba(231,30,99,0.10);
  transition:transform 0.45s var(--ease-out), box-shadow 0.45s var(--ease-out);
}

.question-card::before{
  content:"";
  position:absolute;
  inset:-120px;
  background:radial-gradient(circle at 30% 20%, rgba(255,255,255,0.85) 0%, transparent 55%);
  opacity:0.55;
  transform:translate3d(0, 18px, 0) rotate(8deg);
  pointer-events:none;
  transition:transform 0.9s var(--ease-out), opacity 0.9s var(--ease-out);
}

@media (hover:hover){
  .question-card:hover{
    transform:translateY(-4px);
    box-shadow:0 28px 90px rgba(231, 30, 99, 0.28);
  }
  .question-card:hover::before{
    opacity:0.75;
    transform:translate3d(0, -14px, 0) rotate(8deg);
  }
}

.question-title{
  font-size:1.3rem;
  color:var(--accent);
  margin:0 0 20px 0;
  font-weight:600;
  font-family:Georgia, serif;
}

.main-question{
  font-size:2rem;
  font-weight:700;
  color:var(--accent);
  margin:0 0 16px 0;
  line-height:1.3;
  text-shadow:0 2px 8px rgba(231,30,99,0.2);
}

.romantic-quote{
  font-size:1.05rem;
  color:#555;
  font-style:italic;
  line-height:1.6;
  margin:0;
  font-family:Georgia, serif;
}

.question-buttons{
  display:flex;
  gap:16px;
  justify-content:center;
  align-items:center;
  margin-top:24px;
}

.btn{
  padding:16px 32px;
  border-radius:50px;
  border:none;
  font-weight:700;
  font-size:1.1rem;
  cursor:pointer;
  touch-action:manipulation;
  transition:transform 0.35s var(--ease-spring), box-shadow 0.35s var(--ease-spring), filter 0.35s var(--ease-spring);
  position:relative;
  overflow:hidden;
}

@media (hover:hover){
  .btn:not(.btn-no):hover{
    transform:translateY(-2px);
    filter:saturate(1.05);
  }
}

.btn-yes{
  background:linear-gradient(135deg,var(--accent) 0%,var(--accent-light) 100%);
  color:#fff;
  box-shadow:0 12px 35px rgba(231,30,99,0.3);
  text-shadow:0 1px 2px rgba(0,0,0,0.1);
  flex:1;
  max-width:180px;
}

@media (hover:hover){
  .btn-yes:hover{
    box-shadow:0 18px 50px rgba(231,30,99,0.35);
  }
}

.btn-yes:active{
  transform:scale(0.95);
}

.btn-no{
  background:rgba(255,255,255,0.9);
  backdrop-filter:blur(10px);
  border:2px solid rgba(231,30,99,0.2);
  color:var(--accent);
  transition:background-color 0.2s ease, border-color 0.2s ease;
  position:absolute;
  will-change:transform;
}

.btn-no:active{
  filter:brightness(0.98);
}

/* No button container */
.no-container{
  position:relative;
  width:140px;
  height:56px;
}

/* Attempts message */
.attempts{
  color:var(--accent);
  font-weight:700;
  font-size:1rem;
  margin-top:16px;
  opacity:0;
  transition:opacity 0.3s;
  text-align:center;
  text-shadow:0 2px 4px rgba(231,30,99,0.2);
  min-height:24px;
}

.attempts.show{
  opacity:1;
  animation:bounce 0.5s ease;
}

@keyframes bounce{
  0%, 100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}

/* CELEBRATION PAGE */
.celebration-content{
  width:100%;
  max-width:440px;
  text-align:center;
}

@keyframes celebrationEnter{
  from{opacity:0;transform:scale(0.5) rotate(-10deg)}
  to{opacity:1;transform:scale(1) rotate(0deg)}
}

.celebration-card{
  background:linear-gradient(180deg,var(--glass),#fff);
  border-radius:24px;
  padding:40px 24px;
  box-shadow:0 25px 70px rgba(231,30,99,0.35);
  position:relative;
  z-index:5;
  overflow:hidden;
  border:1px solid rgba(231,30,99,0.10);
  transition:transform 0.45s var(--ease-out), box-shadow 0.45s var(--ease-out);
}

.celebration-card::before{
  content:"";
  position:absolute;
  inset:-140px;
  background:radial-gradient(circle at 30% 18%, rgba(255,255,255,0.82) 0%, transparent 58%);
  opacity:0.50;
  transform:translate3d(0, 18px, 0) rotate(8deg);
  pointer-events:none;
  transition:transform 0.9s var(--ease-out), opacity 0.9s var(--ease-out);
}

@media (hover:hover){
  .celebration-card:hover{
    transform:translateY(-4px);
    box-shadow:0 35px 110px rgba(231,30,99,0.34);
  }
  .celebration-card:hover::before{
    opacity:0.72;
    transform:translate3d(0, -16px, 0) rotate(8deg);
  }
}

.celebration-title{
  font-size:2.5rem;
  color:var(--accent);
  margin:0 0 16px 0;
  font-weight:700;
}

.celebration-message{
  font-size:1.2rem;
  color:#555;
  margin:0 0 24px 0;
  line-height:1.5;
}

/* Photo grid in celebration */
.photo-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));
  gap:12px;
  margin-top:24px;
  padding:0 8px;
}

.photo-grid img{
  width:100%;
  height:120px;
  object-fit:cover;
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,0.15);
  border:3px solid #fff;
  animation:photoReveal 0.6s ease-out both;
}

@keyframes photoReveal{
  from{opacity:0;transform:scale(0.3) rotateY(90deg)}
  to{opacity:1;transform:scale(1) rotateY(0deg)}
}

.photo-grid img:nth-child(1){animation-delay:0.1s}
.photo-grid img:nth-child(2){animation-delay:0.2s}
.photo-grid img:nth-child(3){animation-delay:0.3s}
.photo-grid img:nth-child(4){animation-delay:0.4s}
.photo-grid img:nth-child(5){animation-delay:0.5s}
.photo-grid img:nth-child(6){animation-delay:0.6s}

.celebration-buttons{
  display:flex;
  gap:12px;
  justify-content:center;
  margin-top:24px;
  flex-wrap:wrap;
}

.btn-small{
  padding:12px 24px;
  border-radius:12px;
  background:#fff;
  border:2px solid #f0e6eb;
  cursor:pointer;
  font-size:0.95rem;
  font-weight:600;
  transition:transform 0.25s var(--ease-out), box-shadow 0.25s var(--ease-out), border-color 0.25s ease;
  text-decoration:none;
  display:inline-block;
  color:#333;
  position:relative;
  overflow:hidden;
}

@media (hover:hover){
  .btn-small:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 28px rgba(0,0,0,0.12);
    border-color:#ead6df;
  }
}

.btn-small:active{
  transform:scale(0.95);
}

/* Confetti canvas */
#confetti{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:3;
}

/* Footer */
.footer{
  position:fixed;
  bottom:20px;
  left:0;
  right:0;
  text-align:center;
  color:var(--muted);
  font-size:0.85rem;
  z-index:5;
  opacity:0.7;
}

/* Responsive - Optimized for laptop screens */
@media (min-width:520px){
  .big-heart{font-size:220px}
  .main-question{font-size:2.5rem}
  .celebration-title{font-size:3rem}
  .question-card{padding:50px 40px}
  .celebration-card{padding:50px 40px}
}

@media (min-width:768px){
  .big-heart{font-size:260px}
  .main-question{font-size:2.8rem}
  .romantic-quote{font-size:1.2rem}
  .celebration-title{font-size:3.5rem}
  .celebration-message{font-size:1.3rem}
  .photo-grid{
    grid-template-columns:repeat(3, 1fr);
    gap:16px;
    max-width:600px;
    margin-left:auto;
    margin-right:auto;
  }
  .photo-grid img{
    height:140px;
  }
}

@media (min-width:1024px){
  .big-heart{font-size:300px}
  .tap-hint{font-size:1.3rem}
  .main-question{font-size:3rem}
  .romantic-quote{font-size:1.3rem}
  .celebration-title{font-size:4rem}
  .celebration-message{font-size:1.4rem}
  .question-card{
    padding:60px 50px;
    max-width:500px;
  }
  .celebration-card{
    padding:60px 50px;
    max-width:600px;
  }
  .photo-grid img{
    height:160px;
  }
  .btn-yes{
    font-size:1.2rem;
    padding:18px 40px;
  }
  .btn-no{
    font-size:1.1rem;
    padding:16px 36px;
  }
}

@media (max-height:700px){
  .big-heart{font-size:140px}
  .question-card{padding:30px 20px}
  .celebration-card{padding:30px 20px}
}

@media (max-width:360px){
  .big-heart{font-size:140px}
  .main-question{font-size:1.7rem}
}

@media (prefers-reduced-motion: reduce){
  *, *::before, *::after{
    animation-duration:0.001ms !important;
    animation-iteration-count:1 !important;
    transition-duration:0.001ms !important;
  }
  .gradient-overlay{animation:none !important}
}
  </style>
</head>
<body>
  <div class="gradient-overlay"></div>
  <canvas id="bg"></canvas>
  <canvas id="confetti"></canvas>

  <!-- LANDING PAGE - First Heart -->
  <div id="landingPage" class="page active">
    <div class="landing-content reveal" data-reveal-delay="50">
      <div class="big-heart" id="bigHeart" tabindex="0" role="button" aria-label="Tap to continue">üíñ</div>
      <p class="tap-hint">‚ú® Tap the heart ‚ú®</p>
    </div>
  </div>

  <!-- QUESTION PAGE -->
  <div id="questionPage" class="page">
    <div class="question-content">
      <div class="question-card reveal" data-reveal-delay="60">
        <h2 class="question-title">For My Dearest Riti üíï</h2>
        <h1 class="main-question">Will You Be My Valentine?</h1>
        <p class="romantic-quote">"In your eyes, I found my home. In your smile, I found my happiness. You are my forever."</p>
      </div>

      <div class="question-buttons reveal" data-reveal-delay="140">
        <button id="yesBtn" class="btn btn-yes">Yes! üíï</button>
        <div class="no-container">
          <button id="noBtn" class="btn btn-no">No</button>
        </div>
      </div>

      <div id="attempts" class="attempts"></div>
    </div>
  </div>

  <!-- CELEBRATION PAGE -->
  <div id="celebrationPage" class="page">
    <div class="celebration-content">
      <div class="celebration-card reveal" data-reveal-delay="70">
        <h2 class="celebration-title">Yay! üéâ</h2>
        <p class="celebration-message">You said YES! My heart is overflowing with joy! üíï</p>
        
        <div class="photo-grid reveal" id="photoGrid" data-reveal-delay="160"></div>

        <div class="celebration-buttons reveal" data-reveal-delay="240">
          <button id="downloadBtn" class="btn-small">Download üíæ</button>
          <button id="shareBtn" class="btn-small">Share üíù</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">Made with endless love ‚ù§Ô∏è by Shoaib</footer>

  <script>
(() => {
  // ========================================
  // YOUR PHOTOS - ADD YOUR IMAGES HERE
  // ========================================
  const YOUR_PHOTOS = [
    'https://i.ibb.co/v41QT2Yc/2024-11-16-18-04-IMG-5040.jpg',
    'https://i.ibb.co/nq3tmLBL/2024-11-16-19-05-IMG-5174.jpg',
    'https://i.ibb.co/jvbysPTG/2025-04-14-17-49-IMG-6726.jpg',
    'https://i.ibb.co/bgj05DbK/2025-05-13-23-18-IMG-7118.jpg',
    'https://i.ibb.co/QvLnJFng/2025-11-16-17-31-IMG-8845.jpg',
    'https://i.ibb.co/rGks2Vpp/2025-11-16-18-28-IMG-8876.jpg'
  ];

  // Elements
  const $ = id => document.getElementById(id);
  const bg = $('bg');
  const confetti = $('confetti');
  const landingPage = $('landingPage');
  const questionPage = $('questionPage');
  const celebrationPage = $('celebrationPage');
  const bigHeart = $('bigHeart');
  const yesBtn = $('yesBtn');
  const noBtn = $('noBtn');
  const attemptsEl = $('attempts');
  const photoGrid = $('photoGrid');
  const downloadBtn = $('downloadBtn');
  const shareBtn = $('shareBtn');
  const questionContent = questionPage.querySelector('.question-content');

  const gradientOverlay = document.querySelector('.gradient-overlay');

  const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)');

  let revealObserver = null;
  let observedReveals = [];

  function ensureRevealObserver(){
    if (revealObserver) return;
    if (prefersReducedMotion && prefersReducedMotion.matches) return;
    revealObserver = new IntersectionObserver((entries) => {
      for (const entry of entries) {
        if (!entry.isIntersecting) continue;
        entry.target.classList.add('is-revealed');
        triggerRevealPop(entry.target);
        revealObserver.unobserve(entry.target);
      }
    }, { threshold: 0.18, rootMargin: '0px 0px -10% 0px' });
  }

  function triggerRevealPop(el){
    if (prefersReducedMotion && prefersReducedMotion.matches) return;
    if (!el || !el.animate) return;
    el.animate(
      [
        { transform: 'translateY(0) scale(1)' },
        { transform: 'translateY(0) scale(1.018)' },
        { transform: 'translateY(0) scale(1)' }
      ],
      { duration: 320, easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)' }
    );
  }

  function clearRevealObservation(){
    if (!revealObserver) return;
    for (const el of observedReveals) revealObserver.unobserve(el);
    observedReveals = [];
  }

  function activateRevealsForPage(page){
    const reveals = Array.from(page.querySelectorAll('.reveal'));
    for (const el of reveals) {
      el.classList.remove('is-revealed');
      const delay = Number(el.getAttribute('data-reveal-delay') || 0);
      el.style.setProperty('--reveal-delay', `${delay}ms`);
    }

    if (prefersReducedMotion && prefersReducedMotion.matches) {
      for (const el of reveals) el.classList.add('is-revealed');
      return;
    }

    ensureRevealObserver();
    clearRevealObservation();
    observedReveals = reveals;
    for (const el of reveals) revealObserver.observe(el);

    requestAnimationFrame(() => {
      for (const el of reveals) {
        const r = el.getBoundingClientRect();
        if (r.bottom > 0 && r.top < window.innerHeight) {
          el.classList.add('is-revealed');
          triggerRevealPop(el);
          if (revealObserver) revealObserver.unobserve(el);
        }
      }
    });
  }

  (function setupParallax(){
    if (!gradientOverlay) return;
    if (prefersReducedMotion && prefersReducedMotion.matches) return;

    const max = 14;
    const max2 = 10;
    let tx = 0, ty = 0;
    let x = 0, y = 0;
    let driftT = Math.random() * 1000;
    let raf = null;

    function setTargetFromClient(clientX, clientY){
      const w = Math.max(1, window.innerWidth);
      const h = Math.max(1, window.innerHeight);
      const nx = (clientX / w) - 0.5;
      const ny = (clientY / h) - 0.5;
      tx = nx * max;
      ty = ny * max;
    }

    window.addEventListener('pointermove', (e) => {
      if (e.pointerType === 'mouse' || e.pointerType === 'pen') setTargetFromClient(e.clientX, e.clientY);
    }, { passive: true });

    window.addEventListener('touchmove', (e) => {
      if (!e.touches || !e.touches[0]) return;
      const t = e.touches[0];
      setTargetFromClient(t.clientX, t.clientY);
    }, { passive: true });

    const step = (now) => {
      driftT += 0.0016 * (now ? 16 : 16);
      const dx = Math.sin(driftT * 0.9) * 3.2;
      const dy = Math.cos(driftT * 0.8) * 2.6;

      x += (tx - x) * 0.06;
      y += (ty - y) * 0.06;

      const px = (x + dx).toFixed(2);
      const py = (y + dy).toFixed(2);
      gradientOverlay.style.setProperty('--px', `${px}px`);
      gradientOverlay.style.setProperty('--py', `${py}px`);
      gradientOverlay.style.setProperty('--gox', `${(x * 0.6 + dx).toFixed(2)}px`);
      gradientOverlay.style.setProperty('--goy', `${(y * 0.6 + dy).toFixed(2)}px`);
      gradientOverlay.style.setProperty('--gox2', `${(-x * 0.45 - dx * 0.8).toFixed(2)}px`);
      gradientOverlay.style.setProperty('--goy2', `${(-y * 0.45 - dy * 0.8).toFixed(2)}px`);

      raf = requestAnimationFrame(step);
    };

    raf = requestAnimationFrame(step);
  })();

  (function setupRipples(){
    if (prefersReducedMotion && prefersReducedMotion.matches) return;

    document.addEventListener('pointerdown', (e) => {
      const btn = e.target && e.target.closest ? e.target.closest('.btn, .btn-small') : null;
      if (!btn) return;
      if (btn.classList && btn.classList.contains('btn-no')) return;

      const rect = btn.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height) * 1.8;
      const ripple = document.createElement('span');
      ripple.className = 'ripple';
      ripple.style.width = ripple.style.height = `${size}px`;
      ripple.style.left = `${e.clientX - rect.left - size / 2}px`;
      ripple.style.top = `${e.clientY - rect.top - size / 2}px`;

      btn.appendChild(ripple);
      ripple.addEventListener('animationend', () => ripple.remove(), { once: true });
    }, { passive: true });
  })();

  // Enhanced background with particles - 60Hz optimized for laptop
  function makeBG() {
    const ctx = bg.getContext('2d');
    let w = bg.width = innerWidth;
    let h = bg.height = innerHeight;
    const parts = [];
    const shapes = ['üíñ','üíû','üíï','üíó','‚ù§Ô∏è','üíò','üåπ','‚ú®'];
    
    // More particles for larger laptop screens
    const particleCount = Math.min(Math.floor((w * h) / 15000), 60);
    
    for(let i=0; i<particleCount; i++){
      parts.push({
        x: Math.random()*w,
        y: Math.random()*h,
        vx: (Math.random()-0.5)*0.8,  // Faster horizontal for laptop
        vy: -0.6 - Math.random()*1.2,  // Faster upward movement
        s: 20 + Math.random()*32,
        r: Math.random()*Math.PI*2,
        vr: (Math.random()-0.5)*0.02,
        shape: shapes[Math.floor(Math.random()*shapes.length)],
        a: 0.35 + Math.random()*0.55
      });
    }
    
    addEventListener('resize', ()=>{ 
      w = bg.width = innerWidth; 
      h = bg.height = innerHeight;
      // Adjust particle count on resize
      const newCount = Math.min(Math.floor((w * h) / 15000), 60);
      while(parts.length < newCount){
        parts.push({
          x: Math.random()*w,
          y: Math.random()*h,
          vx: (Math.random()-0.5)*0.8,
          vy: -0.6 - Math.random()*1.2,
          s: 20 + Math.random()*32,
          r: Math.random()*Math.PI*2,
          vr: (Math.random()-0.5)*0.02,
          shape: shapes[Math.floor(Math.random()*shapes.length)],
          a: 0.35 + Math.random()*0.55
        });
      }
      while(parts.length > newCount){
        parts.pop();
      }
    });
    
    const targetFPS = 60;
    const frameTime = 1000 / targetFPS;
    let lastFrameTime = performance.now();
    
    (function draw(){
      const currentTime = performance.now();
      const elapsed = currentTime - lastFrameTime;
      
      // Lock to 60 FPS
      if(elapsed >= frameTime - 1){
        lastFrameTime = currentTime - (elapsed % frameTime);
        
        ctx.clearRect(0, 0, w, h);
        
        for(const p of parts){
          // Smooth continuous movement
          p.x += p.vx;
          p.y += p.vy;
          p.r += p.vr;
          
          // Smooth wraparound - reset when off screen
          if(p.y < -100) {
            p.y = h + 80;
            p.x = Math.random() * w;
            p.vx = (Math.random()-0.5)*0.8;
            p.vy = -0.6 - Math.random()*1.2;
          }
          if(p.x < -100) {
            p.x = w + 80;
          }
          if(p.x > w + 100) {
            p.x = -80;
          }
          
          ctx.save();
          ctx.globalAlpha = p.a;
          ctx.translate(p.x, p.y);
          ctx.rotate(p.r);
          ctx.font = `${p.s}px serif`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(p.shape, 0, 0);
          ctx.restore();
        }
      }
      
      requestAnimationFrame(draw);
    })();
  }
  makeBG();

  activateRevealsForPage(landingPage);

  // Page navigation
  function showPage(page) {
    [landingPage, questionPage, celebrationPage].forEach(p => p.classList.remove('active'));
    page.classList.add('active');
    activateRevealsForPage(page);
    if (page === questionPage) resetNoState();
  }

  // Landing heart click -> Question page
  bigHeart.addEventListener('click', () => {
    playSound(800, 0.03, 0.15);
    showPage(questionPage);
  });

  bigHeart.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      bigHeart.click();
    }
  });

  // Evasive No button
  let attempts = 0;
  const messages = [
    "Really? Try again! üòè",
    "You can't escape love! üíï",
    "Nope! üí®",
    "Too slow! üèÉ",
    "Just say Yes! üíñ",
    "Come on, Riti! üòä",
    "I know you want to! üíó",
    "Stop running! üòÑ",
    "Please? ü•∫",
    "Say Yes already! üíù"
  ];
  
  function showAttempt() {
    attemptsEl.classList.add('show');
    attemptsEl.textContent = messages[Math.min(attempts-1, messages.length-1)];
    setTimeout(() => attemptsEl.classList.remove('show'), 2000);
  }

  function moveNoAway(clientX, clientY) {
    attempts++;
    showAttempt();
    
    const container = noBtn.parentElement;
    const containerRect = container.getBoundingClientRect();
    const btnRect = noBtn.getBoundingClientRect();

    // Full-screen playground with small corner exclusion
    const pad = 40;
    const halfW = btnRect.width / 2;
    const halfH = btnRect.height / 2;
    let minX = pad + halfW;
    let maxX = window.innerWidth - pad - halfW;
    let minY = pad + halfH;
    let maxY = window.innerHeight - pad - halfH;
    
    // Calculate angle away from cursor/touch
    const centerX = btnRect.left + btnRect.width/2;
    const centerY = btnRect.top + btnRect.height/2;
    const angle = Math.atan2(centerY - clientY, centerX - clientX);
    
    // Calculate new position with randomness to avoid always going to center
    const distance = 180 + Math.random()*200 + attempts*8;
    let newX = centerX + Math.cos(angle) * distance;
    let newY = centerY + Math.sin(angle) * distance;

    // Keep within screen bounds (excluding corners)
    newX = Math.max(minX, Math.min(maxX, newX));
    newY = Math.max(minY, Math.min(maxY, newY));

    // If too close to an edge, add random bias away from center
    const edgeX = Math.min(newX - minX, maxX - newX);
    const edgeY = Math.min(newY - minY, maxY - newY);
    if (edgeX < 60 || edgeY < 60) {
      const biasAngle = Math.random() * Math.PI * 2;
      const biasDist = 80 + Math.random() * 120;
      newX += Math.cos(biasAngle) * biasDist;
      newY += Math.sin(biasAngle) * biasDist;
      // Clamp again after bias
      newX = Math.max(minX, Math.min(maxX, newX));
      newY = Math.max(minY, Math.min(maxY, newY));
    }

    // Ensure it moved a reasonable distance; if not, randomize
    const moved = Math.hypot(newX - centerX, newY - centerY);
    if (moved < 100) {
      newX = minX + Math.random() * (maxX - minX);
      newY = minY + Math.random() * (maxY - minY);
    }
    
    // Convert to relative position
    const relX = newX - containerRect.left - containerRect.width/2;
    const relY = newY - containerRect.top - containerRect.height/2;
    
    // Apply transform
    const scale = Math.max(0.5, 1 - attempts*0.04);
    const rotation = attempts * 8;
    tweenNoTo({ x: relX, y: relY, scale, rot: rotation });
    
    // Change emoji
    if (attempts > 5) noBtn.textContent = 'üòÖ';
    if (attempts > 10) noBtn.textContent = 'üò∞';
    if (attempts > 15) noBtn.textContent = 'üò±';
    
    playSound(600, 0.02, 0.1);
  }

  let noTweenRaf = null;
  let noState = { x: 0, y: 0, scale: 1, rot: 0 };

  function applyNoState(s){
    noBtn.style.transform = `translate(${s.x}px, ${s.y}px) scale(${s.scale}) rotate(${s.rot}deg)`;
  }

  function easeOutCubic(t){
    return 1 - Math.pow(1 - t, 3);
  }

  function tweenNoTo(target){
    if (prefersReducedMotion && prefersReducedMotion.matches) {
      noState = target;
      applyNoState(noState);
      return;
    }
    if (noTweenRaf) cancelAnimationFrame(noTweenRaf);

    const start = { ...noState };
    const startTime = performance.now();
    const dist = Math.hypot(target.x - start.x, target.y - start.y);
    const duration = Math.min(650, Math.max(280, dist * 1.1));

    const step = (now) => {
      const t = Math.min(1, (now - startTime) / duration);
      const e = easeOutCubic(t);
      noState = {
        x: start.x + (target.x - start.x) * e,
        y: start.y + (target.y - start.y) * e,
        scale: start.scale + (target.scale - start.scale) * e,
        rot: start.rot + (target.rot - start.rot) * e
      };
      applyNoState(noState);
      if (t < 1) noTweenRaf = requestAnimationFrame(step);
    };

    noTweenRaf = requestAnimationFrame(step);
  }

  function resetNoState(){
    attempts = 0;
    noBtn.textContent = 'No';
    attemptsEl.textContent = '';
    attemptsEl.classList.remove('show');
    tweenNoTo({ x: 0, y: 0, scale: 1, rot: 0 });
  }

  noBtn.addEventListener('pointerenter', (e) => {
    if(e.pointerType !== 'mouse') return; // Only on hover for mouse
    moveNoAway(e.clientX, e.clientY);
  });

  noBtn.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    moveNoAway(e.clientX, e.clientY);
  });

  noBtn.addEventListener('focus', () => {
    moveNoAway(window.innerWidth/2, window.innerHeight/2);
  });

  // YES button -> Celebration
  yesBtn.addEventListener('click', () => {
    showPage(celebrationPage);
    startConfetti();
    playMelody();
    loadPhotos();
  });

  // Load photos into celebration page
  function loadPhotos() {
    if(YOUR_PHOTOS.length === 0) return;
    
    photoGrid.innerHTML = '';
    YOUR_PHOTOS.slice(0, 6).forEach((src, idx) => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = 'Our memory';
      img.style.animationDelay = `${idx * 0.1}s`;
      photoGrid.appendChild(img);
    });
  }

  // Confetti animation - 60Hz optimized
  let confettiId = null;
  
  function startConfetti() {
    confetti.width = window.innerWidth;
    confetti.height = window.innerHeight;
    const ctx = confetti.getContext('2d');
    const parts = [];
    const colors = ['#ff6b9d','#ff8a80','#e91e63','#f48fb1','#ffb3ba','#ffd1dc','#ff1744'];
    const shapes = ['üíï','üíñ','üíó','üíù','üíì','‚ù§Ô∏è','üåπ'];
    
    // More particles for laptop screens
    const particleCount = Math.min(Math.floor((confetti.width * confetti.height) / 8000), 250);
    
    for (let i=0; i<particleCount; i++){
      parts.push({ 
        x: Math.random()*confetti.width, 
        y: -Math.random()*confetti.height*0.5, 
        vx: (Math.random()-0.5)*12, 
        vy: 3+Math.random()*12, 
        s: 10+Math.random()*18, 
        c: colors[Math.floor(Math.random()*colors.length)], 
        shape: Math.random() > 0.6 ? shapes[Math.floor(Math.random()*shapes.length)] : null,
        r: Math.random()*Math.PI*2, 
        vr: (Math.random()-0.5)*0.5,
        a: 0.7 + Math.random()*0.3,
        gravity: 0.2
      });
    }
    
    const targetFPS = 60;
    const frameTime = 1000 / targetFPS;
    let lastFrameTime = performance.now();
    
    function frame(){
      const currentTime = performance.now();
      const elapsed = currentTime - lastFrameTime;
      
      // Lock to 60 FPS
      if(elapsed >= frameTime - 1){
        lastFrameTime = currentTime - (elapsed % frameTime);
        
        ctx.clearRect(0, 0, confetti.width, confetti.height);
        
        for (const p of parts) {
          p.x += p.vx;
          p.y += p.vy;
          p.r += p.vr;
          p.vy += p.gravity;
          
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.r);
          ctx.globalAlpha = p.a;
          
          if(p.shape){
            ctx.font = `${p.s*1.8}px serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(p.shape, 0, 0);
          } else {
            ctx.fillStyle = p.c;
            ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s*2.5);
          }
          
          ctx.restore();
          
          if (p.y > confetti.height + 50) {
            p.y = -50;
            p.x = Math.random() * confetti.width;
            p.vy = 3 + Math.random() * 10;
            p.vx = (Math.random()-0.5) * 12;
          }
        }
      }
      
      confettiId = requestAnimationFrame(frame);
    }
    
    confettiId = requestAnimationFrame(frame);
  }
  
  function stopConfetti() {
    if (confettiId) {
      cancelAnimationFrame(confettiId);
      confettiId = null;
    }
    const ctx = confetti.getContext('2d');
    if (ctx) ctx.clearRect(0, 0, confetti.width, confetti.height);
  }

  // Sound effects
  function playSound(freq, volume, duration) {
    try {
      const ac = new (window.AudioContext || window.webkitAudioContext)();
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.type = 'sine';
      o.frequency.value = freq;
      g.gain.value = 0.0001;
      o.connect(g);
      g.connect(ac.destination);
      o.start(ac.currentTime);
      g.gain.exponentialRampToValueAtTime(volume, ac.currentTime + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime + duration);
      o.stop(ac.currentTime + duration + 0.1);
    } catch(e){}
  }

  function playMelody() {
    try {
      const ac = new (window.AudioContext || window.webkitAudioContext)();
      const notes = [523.25, 587.33, 659.25, 783.99, 880, 783.99, 659.25, 587.33, 523.25];
      let now = ac.currentTime;
      
      for (let i=0; i<notes.length; i++){
        const o = ac.createOscillator();
        const g = ac.createGain();
        o.type = 'sine';
        o.frequency.value = notes[i];
        g.gain.value = 0.0001;
        o.connect(g);
        g.connect(ac.destination);
        o.start(now + i*0.2);
        g.gain.exponentialRampToValueAtTime(0.08, now + i*0.2 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, now + i*0.2 + 0.4);
        o.stop(now + i*0.2 + 0.5);
      }
    } catch(e){}
  }

  // Download card as image
  downloadBtn.addEventListener('click', async () => {
    const imageBlob = await renderCardImage();
    const url = URL.createObjectURL(imageBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'valentine-for-riti.png';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // Share button
  shareBtn.addEventListener('click', async () => {
    if (navigator.share) {
      try { 
        await navigator.share({ 
          title: 'Valentine for Riti', 
          text: 'She said YES! üíï' 
        }); 
      } catch(e) {}
    } else {
      alert('Share feature not supported on this browser. Use download instead! üíù');
    }
  });

  // Render card image
  async function renderCardImage() {
    const w = 1080;
    const h = 1920;
    const cv = document.createElement('canvas');
    cv.width = w;
    cv.height = h;
    const ctx = cv.getContext('2d');

    // Background gradient
    const g = ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0,'#ff9bb3');
    g.addColorStop(0.5,'#ffd7e0');
    g.addColorStop(1,'#fff7fb');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);

    // Decorative hearts
    ctx.font = '80px serif';
    ctx.textAlign = 'center';
    ctx.globalAlpha = 0.3;
    ['üíñ','üíï','üíó'].forEach((h, i) => {
      ctx.fillText(h, 200 + i*340, 150);
    });
    ctx.globalAlpha = 1;

    // Main heart
    ctx.font = '200px serif';
    ctx.fillText('üíû', w/2, 350);

    // Title
    ctx.font = 'bold 72px Georgia';
    ctx.fillStyle = '#e71e63';
    ctx.fillText('For My Riti', w/2, 550);

    // Photos grid
    let y = 650;
    if(YOUR_PHOTOS.length > 0){
      const thumbSize = 240;
      const gap = 20;
      const cols = 2;
      const rows = Math.ceil(Math.min(YOUR_PHOTOS.length, 6) / cols);
      
      for(let i=0; i < Math.min(YOUR_PHOTOS.length, 6); i++){
        const row = Math.floor(i / cols);
        const col = i % cols;
        const x = (w - (cols * thumbSize + gap)) / 2 + col * (thumbSize + gap);
        const py = y + row * (thumbSize + gap);
        
        await new Promise((res) => {
          const img = new Image();
          img.crossOrigin = 'anonymous';
          img.onload = () => {
            ctx.save();
            roundRect(ctx, x, py, thumbSize, thumbSize, 24);
            ctx.clip();
            ctx.drawImage(img, x, py, thumbSize, thumbSize);
            ctx.restore();
            res();
          };
          img.onerror = () => {
            // Fallback: draw placeholder if image fails to load
            ctx.save();
            roundRect(ctx, x, py, thumbSize, thumbSize, 24);
            ctx.fillStyle = '#f0e6eb';
            ctx.fill();
            ctx.fillStyle = '#999';
            ctx.font = '24px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üì∑', x + thumbSize/2, py + thumbSize/2);
            ctx.restore();
            res();
          };
          img.src = YOUR_PHOTOS[i];
        });
      }
      y += rows * (thumbSize + gap) + 40;
    }

    // Message
    ctx.fillStyle = '#4a0022';
    ctx.font = '42px Georgia';
    const lines = [
      'She said YES!',
      '',
      'Forever & Always'
    ];
    lines.forEach((line, i) => {
      ctx.fillText(line, w/2, y + i*60);
    });

    // Footer
    ctx.font = 'italic 32px Georgia';
    ctx.fillStyle = '#6d2940';
    ctx.fillText('Made with Love ‚ù§Ô∏è by Shoaib', w/2, h - 120);

    return new Promise(resolve => cv.toBlob(blob => resolve(blob), 'image/png', 0.95));
  }

  function roundRect(ctx, x, y, w, h, r) {
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
  }

  // Resize handler
  window.addEventListener('resize', () => {
    confetti.width = window.innerWidth;
    confetti.height = window.innerHeight;
    bg.width = innerWidth;
    bg.height = innerHeight;
  });

})();
  </script>
</body>
</html>
